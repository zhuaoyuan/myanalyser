东方财富、同花顺等平台是公开的数据提供者，但产品设计无法满足定制化的需求。
akshare是最常用的此类数据接口api集成库，对平台api做了标准化封装。
本项目在akshare的数据上，进行进一步定制化处理，例如：
- 原始数据中的单位净值无法直接用于计算收益率，累计净值未考虑分红复投，平台累计收益率数据为复权后数据，但步长太长，无法支持精确的分析
或回测。因此需要自行计算天级复权净值。
- 据称部分平台数据有偏差，因此本地尽可能对数据再做交叉比对，剔除问题数据。
- 按需支持自定义的筛选和排序方法。

## 未处理的问题
- 尚未支持货币基金的净值数据处理。暂时不是关注重点，后续补上。
- 历史数据接口总是按基金编码全量获取，而没有增量方案，单次更新数据代价较大。当前基于基金投资的特点，暂时按月为周期执行一次全量分析。
- 部分基金的历史单位净值数据步长大于一天，可能跳过分红日/拆分日，而导致复权净值无法计算。可以关注近3年或近5年数据，减小此类影响面。
近期仍存在此类异常的基金则认为数据不可靠，先剔除。
- 部分基金的历史分红数据不符合预期，导致复权净值计算错误。目前通过本地计算的复权净值和平台计算的累计收益率比对发现，前期剔除，后期排查。

## TODO
各环节数据过滤原因分析，数据补全
给关键中间产物补 schema 校验（列名/类型/非空/唯一键）并在每步入口强制检查。
建一个最小 回归基线数据集（固定样本 + 固定期望输出）进 CI，确保重构不改结果。
增加 运行报告汇总（每步耗时、成功率、异常分布、过滤前后数量变化），让验收结论一眼可读。


scoreboard性能优化
准确滚动回测（Walk-forward Analysis）： 模拟你在2022年用这套逻辑选基，持有到2023年的表现；再模拟2023年选基，持有到2024年的表现。
特征挖掘
对账再细化
当期标的信息跟进维护、宏观监测和风控
组合相关性分析

百分位得分制： 将各项指标转化为在该类基金中的百分位排名（0-100），消除不同指标单位不统一的问题。

数量建议： 一般建议 5-8 只。
- 少于3只：非系统性风险太高（万一某个经理离职或踩雷）。
- 多于10只：边际分散风险的效果递减，且由于公募基金本身就持仓几十只股票，你买太多基金会导致你的组合变成一个“昂贵的沪深300指数”。

配比方法：
- 等权重： 每只 20%，最简单稳健。
- 风险平价（Risk Parity）： 根据波动率分配。波动大的（如科技基金）少配，波动小的（如债基）多配，使得每只基金对组合整体风险的贡献一致。
- 相关性剔除： 即使两只基金得分都高，但如果它们都重仓白酒，也只能选其一。

年化波动率

因子有效性检验： 定期计算你的筛选指标与未来一期收益的相关性（IC值）。如果发现“年化收益率”高的基金未来表现反而变差，就要降低其权重。

最大回撤修复天数 (Recovery Days)： 这是衡量偏债基金“韧性”的核心。如果一只基金跌了 3% 但能在 20 天内涨回来，它的持有体验远好于半年才回本的基金。

得分计算：
分层打分： 既然是类全天候，给**“回撤控制”和“持有胜率”**设置 60% 的权重，给“超额收益”设置 40%。
归一化处理

权重设定：
不要直接按得分高低给权重。得分高的基金往往风险也稍高。你应该根据每只基金的历史波动率倒数来分配比例：


调仓警戒线：

利率环境剧变： 关注十年期国债收益率走势。如果利率快速上行，纯债部分的估值会承压，此时需要缩短组合的久期。

信用风险： 关注你持有的偏债基金是否踩雷。如果净值单日出现异常大幅下跌（如超过 1%），且同类基金没有类似跌幅，大概率是持仓债违约，必须立即止损。


RUN_ID=20260228_si_full_run \
DATA_VERSION=20260228_si_full_run \
ETL_MAX_RETRIES=3 \
ETL_RETRY_SLEEP=1.0 \
ETL_MAX_WORKERS=8 \
ETL_PROGRESS_INTERVAL=5.0 \
STALE_MAX_DAYS=2 \
INTEGRITY_START_DATE=2020-01-01 \
INTEGRITY_END_DATE=2026-02-28 \
FILTER_START_DATE=2023-01-01 \
FILTER_MAX_ABS_DEVIATION=0.02 \
bash myanalyser/tools/start_isolated_pipeline.sh /Users/zhuaoyuan/cursor-workspace/finance/myanalyser/data/versions/20260228_004847_verify_e2e/fund_etl/fund_purchase.csv