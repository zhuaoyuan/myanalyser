# 20260301 基金综合得分计算脚本

## 需求描述

编写一个独立的基金综合得分计算脚本，接收形如 `0301_manual_filtered.csv` 的输入文件，为每个基金计算综合得分并输出新的结果 CSV。

## 计算方法

- **步骤**：原始指标线性归一化 → 分组 → 加权得到二级指标 → 二级指标加权得到综合得分
- **分组与权重**：

  | 二级指标   | 组权重 | 子指标及权重 |
  |------------|--------|--------------|
  | 风险控制   | 35%    | 近1年最大回撤 40% + 近3年最长回撤修复天数 40% + 近3年最大回撤 20% |
  | 短期业绩   | 30%    | 近1年卡玛比率 50% + 近1年年化收益 30% + 最近一个月涨跌幅 20% |
  | 持有体验   | 20%    | 近1年上涨星期比例 30% + 近3年上涨月比例 30% + 近1年周标准差 40% |
  | 长期业绩   | 15%    | 近3年卡玛比率 50% + 近3年年化收益 30% + 近3年夏普比率 20% |

- **归一化**：min-max 线性归一化，越小越好的指标取反后归一化；缺失值按 0.5（中性）处理。

## 实现摘要

- **新增**：`src/compute_fund_composite_score.py`（ standalone CLI）
- **新增**：`tests/test_compute_fund_composite_score.py`（单测）

### CLI 用法

```bash
cd /Users/zhuaoyuan/cursor-workspace/finance
source myanalyser/.venv312/bin/activate

python myanalyser/src/compute_fund_composite_score.py \
  -i myanalyser/result_example/0301_manual_filtered.csv \
  -o /path/to/output.csv
```

### 输出 CSV 新增列

- `得分_风险控制`、`得分_短期业绩`、`得分_持有体验`、`得分_长期业绩`
- `综合得分`
- `综合排名`

## 验收证据

```bash
# 单测
python -m pytest myanalyser/tests/test_compute_fund_composite_score.py -v

# 示例运行
python myanalyser/src/compute_fund_composite_score.py \
  -i myanalyser/result_example/0301_manual_filtered.csv \
  -o /tmp/composite_score_output.csv
```

## 已更新项目元文件（20260301 开发者确认后）

1. **`myanalyser/docs/README.md`** ✓
   - 在「核心脚本」增加：`src/compute_fund_composite_score.py`
   - 在「常用命令」增加 CLI 示例（#10）

2. **`myanalyser/docs/系统设计.md`** ✓
   - 在「4. 核心模块职责」增加：`compute_fund_composite_score.py`

3. **`myanalyser/tools/verify.sh`**
   - 无变更（新脚本已由单测覆盖，不纳入核心 CLI 冒烟）
